{"title":"Sequence Analysis of Neighborhood Change: [YOUR CITY NAME]","markdown":{"yaml":{"title":"Sequence Analysis of Neighborhood Change: [YOUR CITY NAME]","subtitle":"MUSA 5080 - Week 8 Lab Exercise","author":"Your Name","date":"today","format":{"html":{"toc":true,"code-fold":"show","theme":"cosmo","self-contained":true}},"execute":{"warning":false,"message":false}},"headingText":"BEFORE YOU START: Customization Checklist","containsRefs":false,"markdown":"\n\n\n**This template follows the NYC tutorial workflow. You MUST customize:**\n\n- [ ] Line 50-52: Replace NYC county names with YOUR metro counties\n- [ ] Line 54: Replace \"NY\" with YOUR state abbreviation\n- [ ] Line 102-107: Update county filter to YOUR metro counties\n- [ ] Line 270: Adjust k value (may not be 6 for your city)\n- [ ] Line 276-281: Relabel clusters based on YOUR city's demographics\n- [ ] Line 436: Adjust number of trajectory clusters (may not be 14)\n- [ ] Line 444-457: Rename trajectory clusters based on YOUR patterns\n\n**Data Requirements:**\n- LTDB data files in `data/` folder (1980, 1990, 2000, 2010)\n- 2020 Census data (will download via tidycensus)\n- Census API key (get from: https://api.census.gov/data/key_signup.html)\n\n---\n\n# Setup\n\n## Load Libraries\n\n```{r setup}\nlibrary(tidyverse)      # Data manipulation\nlibrary(tidycensus)     # Census data\nlibrary(sf)             # Spatial data\nlibrary(tigris)         # Census boundaries\nlibrary(TraMineR)       # Sequence analysis\nlibrary(cluster)        # Clustering\nlibrary(factoextra)     # Cluster visualization\nlibrary(WeightedCluster)# Cluster validation\nlibrary(knitr)          # Tables\nlibrary(here)           # File paths\n\n# Set Census API key - GET YOUR OWN KEY!\n# census_api_key(\"YOUR_KEY_HERE\", install = TRUE)\n```\n\n## Load LTDB Data\n\n**CUSTOMIZE:** Ensure your file paths match your data location\n\n```{r load_data}\n# Load longitudinal census data from LTDB\ncensus20 <- read.csv(\"data/ltdb_std_2020_fullcount.csv\")\ncensus10 <- read.csv(\"data/LTDB_Std_2010_fullcount.csv\")\ncensus00 <- read.csv(\"data/LTDB_Std_2000_fullcount.csv\")\ncensus90 <- read.csv(\"data/LTDB_Std_1990_fullcount.csv\")\ncensus80 <- read.csv(\"data/LTDB_Std_1980_fullcount.csv\")\n```\n\n## Get Tract Geometries\n\n**CUSTOMIZE:** Replace with YOUR metro area\n\n```{r get_geometry}\n# STEP 1: Define YOUR metro counties\n# NYC example:\nmy_counties <- c(\"Kings\", \"Queens\", \"New York\", \"Richmond\", \"Bronx\")\n# YOUR CITY - Example for Philadelphia:\n# my_counties <- c(\"Philadelphia\", \"Montgomery\", \"Delaware\", \"Chester\", \"Bucks\")\n\nmy_state <- \"NY\"  # CHANGE TO YOUR STATE (e.g., \"PA\", \"CA\", \"TX\")\n\n# Download tract geometries for 2010\ntract <- get_decennial(\n  geography = \"tract\",\n  variables = \"P001001\",\n  year = 2010,\n  state = my_state,\n  county = my_counties,\n  geometry = TRUE,\n  progress = FALSE\n)\n\n# Also get county boundaries for mapping\nmy_state_counties <- counties(state = my_state, cb = TRUE, progress = FALSE)\nmy_metro_counties <- my_state_counties %>%\n  filter(NAME %in% my_counties)\n```\n\n---\n\n# STEP 1: Data Preparation\n\n## Calculate Race/Ethnicity Percentages\n\n```{r calculate_percentages}\n# 1980 data\ncensus80 <- census80 %>% \n  filter(POP80 > 0) %>%\n  mutate(\n    perwhite80 = NHWHT80 / POP80,\n    perblack80 = NHBLK80 / POP80,\n    perhisp80 = HISP80 / POP80,\n    perasian80 = ASIAN80 / POP80\n  ) %>%\n  select(TRTID10, perwhite80, perblack80, perhisp80, perasian80)\n\n# 1990 data\ncensus90 <- census90 %>%\n  filter(POP90 > 0) %>%\n  mutate(\n    perwhite90 = NHWHT90 / POP90,\n    perblack90 = NHBLK90 / POP90,\n    perhisp90 = HISP90 / POP90,\n    perasian90 = ASIAN90 / POP90\n  ) %>%\n  select(TRTID10, state, county, perwhite90, perblack90, perhisp90, perasian90)\n\n# 2000 data\ncensus00 <- census00 %>%\n  filter(POP00 > 0) %>%\n  mutate(\n    perwhite00 = NHWHT00 / POP00,\n    perblack00 = NHBLK00 / POP00,\n    perhisp00 = HISP00 / POP00,\n    perasian00 = ASIAN00 / POP00\n  ) %>%\n  select(TRTID10, perwhite00, perblack00, perhisp00, perasian00)\n\n# 2010 data\ncensus10 <- census10 %>%\n  rename(TRTID10 = tractid) %>%\n  mutate(\n    perwhite10 = nhwht10 / pop10,\n    perblack10 = nhblk10 / pop10,\n    perhisp10 = hisp10 / pop10,\n    perasian10 = asian10 / pop10\n  ) %>%\n  select(TRTID10, perwhite10, perblack10, perhisp10, perasian10)\n\n# 2020 data\ncensus20 <- census20 %>%\n  rename(TRTID10 = TRTID2010) %>%\n  mutate(\n    perwhite20 = nhwt20 / pop20,\n    perblack20 = nhblk20 / pop20,\n    perhisp20 = hisp20 / pop20,\n    perasian20 = asian20 / pop20\n  ) %>%\n  select(TRTID10, perwhite20, perblack20, perhisp20, perasian20)\n```\n\n## Join All Years & Filter to Metro\n\n```{r join_and_filter}\n# Join all decades\ncensus_all <- census90 %>%\n  left_join(census00, by = \"TRTID10\") %>%\n  left_join(census10, by = \"TRTID10\") %>%\n  left_join(census20, by = \"TRTID10\") %>%\n  left_join(census80, by = \"TRTID10\")\n\n# CUSTOMIZE: Filter to YOUR metro counties\n# NYC example:\ncensus_metro <- census_all %>%\n  filter(\n    (state == \"NY\" & county == \"Bronx County\") |\n    (state == \"NY\" & county == \"Kings County\") |\n    (state == \"NY\" & county == \"New York County\") |\n    (state == \"NY\" & county == \"Queens County\") |\n    (state == \"NY\" & county == \"Richmond County\")\n  )\n\n# YOUR CITY - Example for Philadelphia:\n# census_metro <- census_all %>%\n#   filter(\n#     (state == \"PA\" & county == \"Philadelphia County\") |\n#     (state == \"PA\" & county == \"Montgomery County\") |\n#     (state == \"PA\" & county == \"Delaware County\") |\n#     (state == \"PA\" & county == \"Chester County\") |\n#     (state == \"PA\" & county == \"Bucks County\")\n#   )\n\n# Remove NAs and unnecessary columns\ncensus_metro <- census_metro %>%\n  na.omit() %>%\n  select(-state, -county)\n\n# Prepare tract geometries\ntract <- tract %>%\n  select(GEOID, geometry) %>%\n  rename(TRTID10 = GEOID) %>%\n  mutate(TRTID10 = as.double(TRTID10))\n\n# Check results\ncat(\"Number of tracts in analysis:\", nrow(census_metro), \"\\n\")\n```\n\n---\n\n# STEP 2: K-Means Clustering\n\n## Convert to Long Format\n\n```{r reshape_long}\n# Pivot to long format: one row per tract-year\ncensus_long <- census_metro %>%\n  pivot_longer(\n    cols = starts_with(\"per\"),\n    names_to = c(\".value\", \"year\"),\n    names_pattern = \"per(\\\\w+)(\\\\d{2})\"\n  ) %>%\n  mutate(year = case_when(\n    year == \"80\" ~ 1980,\n    year == \"90\" ~ 1990,\n    year == \"00\" ~ 2000,\n    year == \"10\" ~ 2010,\n    year == \"20\" ~ 2020,\n    TRUE ~ as.integer(year)\n  ))\n\n# Data for clustering\ndata_for_clustering <- census_long %>%\n  select(white, black, hisp, asian)\n```\n\n## Test Multiple K Values\n\n```{r test_k_values}\n# Function to calculate WSS\nwss <- function(k) {\n  kmeans(data_for_clustering, k, nstart = 10)$tot.withinss\n}\n\n# Test k from 1 to 10\nk_values <- 1:10\nwss_values <- map_dbl(k_values, wss)\n\n# Elbow plot\nplot(k_values, wss_values, type = \"b\", pch = 19, \n     xlab = \"Number of Clusters K\",\n     ylab = \"Total Within-Cluster Sum of Squares\",\n     main = \"Elbow Method for Optimal K\")\n\n# Silhouette plot\nfviz_nbclust(data_for_clustering, kmeans, method = \"silhouette\") +\n  labs(title = \"Silhouette Method for Optimal K\")\n```\n\n## Choose K and Run K-Means\n\n**CUSTOMIZE:** Adjust k based on your elbow plot AND what makes sense for your city\n\n```{r run_kmeans}\n# NYC used k=6. Your city may need different k!\n# Consider:\n# - What does the elbow plot suggest?\n# - How diverse is your metro area?\n# - Do you need to distinguish mixed-race neighborhoods?\n\nk_chosen <- 6  # ADJUST THIS IF NEEDED\n\nset.seed(123)\nkmeans_result <- kmeans(data_for_clustering, \n                        centers = k_chosen, \n                        nstart = 25)\n\n# Add cluster assignments\ncensus_long$cluster <- kmeans_result$cluster\n\n# Examine cluster centroids\ncluster_profiles <- census_long %>%\n  group_by(cluster) %>%\n  summarise(across(c(white, black, hisp, asian), \n                  ~ round(mean(.), 2)))\n\nkable(cluster_profiles, \n      caption = \"Cluster Profiles: Average Demographics\")\n```\n\n## Label Your Clusters\n\n**CUSTOMIZE:** Give meaningful names based on YOUR city's demographics\n\n```{r label_clusters}\n# NYC example labels (based on demographic profiles):\ncluster_labels <- c(\n  \"1\" = \"1 Black\",\n  \"2\" = \"2 Hispanic\", \n  \"3\" = \"3 White\",\n  \"4\" = \"4 Mixed\",\n  \"5\" = \"5 Asian\",\n  \"6\" = \"6 Black & Hispanic\"\n)\n\n# YOUR CITY: Look at cluster_profiles table above and create YOUR labels\n# Example for different composition:\n# cluster_labels <- c(\n#   \"1\" = \"Majority White\",\n#   \"2\" = \"Majority Black\",\n#   \"3\" = \"Hispanic Growth\",\n#   \"4\" = \"Mixed Race\",\n#   \"5\" = \"Asian Emerging\",\n#   \"6\" = \"Black-Hispanic\"\n# )\n\ncensus_long$label <- factor(cluster_labels[as.character(census_long$cluster)])\n```\n\n## Visualize Clusters\n\n```{r visualize_clusters}\n# Stacked bar chart of cluster makeup\ncluster_profiles_long <- cluster_profiles %>%\n  pivot_longer(cols = c(\"white\", \"black\", \"hisp\", \"asian\"),\n               names_to = \"Demographic\", \n               values_to = \"Proportion\")\n\nggplot(cluster_profiles_long, \n       aes(x = factor(cluster), y = Proportion, fill = Demographic)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = paste(\"Cluster Demographic Makeup - k =\", k_chosen),\n       x = \"Cluster\", y = \"Proportion\") +\n  theme_minimal()\n\n# Map clusters for 2020\ntract_with_clusters <- tract %>%\n  left_join(census_long %>% \n             filter(year == 2020) %>%\n             select(TRTID10, label),\n            by = \"TRTID10\")\n\nggplot(tract_with_clusters) +\n  geom_sf(aes(fill = label), color = NA) +\n  geom_sf(data = my_metro_counties, fill = NA, color = \"black\", size = 0.5) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(title = \"Neighborhood Racial/Ethnic Clusters - 2020\",\n       fill = \"Cluster\") +\n  theme_void()\n```\n\n## Small Multiples: Change Over Time\n\n```{r small_multiples}\ndecades <- c(1980, 1990, 2000, 2010, 2020)\n\ntract_all_decades <- tract %>%\n  left_join(census_long %>% select(TRTID10, year, label),\n            by = \"TRTID10\") %>%\n  filter(!is.na(label)) %>%\n  mutate(year = factor(year, levels = decades))\n\nggplot(tract_all_decades) +\n  geom_sf(aes(fill = label), color = NA) +\n  geom_sf(data = my_metro_counties, fill = NA, \n          color = \"black\", size = 0.5) +\n  facet_wrap(~ year, ncol = 5) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(title = \"Racial Cluster Maps by Decade (1980-2020)\",\n       fill = \"Cluster\") +\n  theme_void() +\n  theme(legend.position = \"bottom\")\n```\n\n**Question:** What spatial patterns do you observe? Where is change occurring?\n\n---\n\n# STEP 3: Sequence Analysis\n\n## Create Sequence Object\n\n```{r create_sequences}\n# Convert to wide format: one row per tract\ncensus_wide <- census_long %>%\n  select(TRTID10, year, label) %>%\n  pivot_wider(names_from = year, values_from = label) %>%\n  select(TRTID10, `1980`, `1990`, `2000`, `2010`, `2020`)\n\n# Check unique states\nunique_states <- unique(unlist(census_wide[, -1]))\nprint(unique_states)\n\n# Create sequence object\nsequence_data <- seqdef(census_wide[, -1])  # Exclude TRTID10\n\n# Check number of distinct sequences\nnum_sequences <- seqtab(sequence_data, idx = 0) %>% nrow\ncat(\"Number of unique sequences:\", num_sequences, \"\\n\")\n\n# Display first few sequences\nhead(sequence_data)\n```\n\n## Visualize All Sequences\n\n```{r plot_sequences}\n# Index plot: shows all sequences\nseqIplot(sequence_data,\n         with.legend = \"right\",\n         cex.legend = 0.6,\n         main = \"All Neighborhood Trajectories (1980-2020)\")\n\n# State distribution plot\nseqdplot(sequence_data, \n         border = NA,\n         main = \"Distribution of Cluster States Over Time\")\n\n# Most frequent sequences\nseqfplot(sequence_data,\n         border = NA,\n         main = \"Most Frequent Sequences\")\n```\n\n**Discuss:** \n- What's the most common pattern (stability? change?)\n- When do most transitions occur?\n\n---\n\n# STEP 4: Compute Dissimilarity (OMstrans)\n\n```{r compute_dissimilarity}\n# Compute substitution costs based on transition rates\ncosts <- seqcost(sequence_data, method = \"TRATE\")\n\n# View substitution cost matrix\ncat(\"Substitution Cost Matrix (based on transition frequencies):\\n\")\nround(costs$sm, 2) %>% \n  as.data.frame() %>%\n  kable()\n\n# Compute OMstrans dissimilarity\n# Parameters:\n# - method = \"OMstran\" (emphasizes ORDER of transitions)\n# - otto = 0.1 (low value = more emphasis on sequencing)\n# - indel = 3 (cost of insertion/deletion)\n# - sm = costs$sm (substitution costs from above)\n\nom_distances <- seqdist(sequence_data, \n                        method = \"OMstran\",\n                        indel = 3,\n                        sm = costs$sm,\n                        otto = 0.1)\n\ncat(\"Dissimilarity matrix computed!\\n\")\ncat(\"Dimensions:\", dim(om_distances), \"\\n\")\n```\n\n**Note:** This may take several minutes for large metros (2000+ tracts)\n\n---\n\n# STEP 5: Hierarchical Clustering of Sequences\n\n## Perform Clustering\n\n```{r hierarchical_clustering}\n# Hierarchical clustering using Ward's method\nclusterward <- agnes(om_distances, diss = TRUE, method = \"ward\")\n\n# Test different numbers of trajectory clusters\n# Start high (e.g., k=20) and examine\ntest_k <- 20\n\nfor(k in c(10, 15, 20)) {\n  clusters <- cutree(clusterward, k = k)\n  cat(\"\\nTesting k =\", k, \"\\n\")\n  cat(\"Cluster sizes:\", table(clusters), \"\\n\")\n}\n```\n\n## Examine Trajectory Clusters Iteratively\n\n```{r examine_trajectories}\n# Start with k=20 and look at sequence frequency plots\ntest_k <- 20\ntest_clusters <- cutree(clusterward, k = test_k)\n\n# Function to plot a specific cluster\nplot_cluster <- function(cluster_num) {\n  seqfplot(sequence_data[test_clusters == cluster_num, ],\n           sortv = \"from.start\",\n           border = NA,\n           main = paste(\"Test Cluster\", cluster_num,\n                       \"(n =\", sum(test_clusters == cluster_num), \")\"))\n}\n\n# Examine clusters 1-5 (do more as needed)\npar(mfrow = c(2, 3))\nfor(i in 1:6) {\n  plot_cluster(i)\n}\npar(mfrow = c(1, 1))\n```\n\n**Instructions:**\n1. Look at each cluster's sequence plot\n2. Note which clusters show similar patterns\n3. Merge clusters that are essentially the same trajectory\n4. Stop when you'd have to merge opposite trajectories\n\n## Choose Final K\n\n**CUSTOMIZE:** Adjust based on your iterative examination\n\n```{r final_clustering}\n# NYC settled on k=14. Your city may need more or fewer!\n# Guidelines:\n# - Smaller metros may have 8-12 trajectory types\n# - Larger, more diverse metros may have 15-20\n# - Balance interpretability with granularity\n\nnum_clusters <- 14  # ADJUST THIS BASED ON YOUR EXAMINATION\n\n# Final clustering\nfinal_clusters <- cutree(clusterward, k = num_clusters)\ncensus_wide$sequence_cluster <- final_clusters\n\n# Cluster sizes\ncat(\"Final cluster sizes:\\n\")\ntable(final_clusters)\n\n# Validate with silhouette widths\nsil <- silhouette(final_clusters, om_distances)\ncat(\"\\nAverage silhouette width:\", round(mean(sil[, \"sil_width\"]), 3), \"\\n\")\ncat(\"(Values > 0.25 indicate reasonable clustering)\\n\")\n```\n\n## Name Your Trajectory Clusters\n\n**CUSTOMIZE:** Give meaningful names after examining sequence plots\n\n```{r name_trajectories}\n# NYC example (k=14):\ntrajectory_names <- c(\n  \"1\" = \"Hispanic Majority to Black & Hispanic\",\n  \"2\" = \"Stability Cluster\",\n  \"3\" = \"White & Mixed Race to Hispanic Majority\",\n  \"4\" = \"White to White & Mixed Race to Hispanic Majority\",\n  \"5\" = \"Black & Hispanic to Hispanic Majority\",\n  \"6\" = \"White Majority to White & Mixed Race\",\n  \"7\" = \"White & Mixed Race to Black & Hispanic\",\n  \"8\" = \"Black & Hispanic to Black Majority\",\n  \"9\" = \"White & Mixed Race to Asian Majority\",\n  \"10\" = \"White & Mixed Race to White Majority\",\n  \"11\" = \"Black & Hispanic to White & Mixed Race\",\n  \"12\" = \"White & Mixed Race to Asian Majority\",\n  \"13\" = \"Black Majority to Black & Hispanic\",\n  \"14\" = \"Black & Hispanic to Asian Majority\"\n)\n\n# YOUR CITY: Create YOUR trajectory names based on sequence plots\n# Example:\n# trajectory_names <- c(\n#   \"1\" = \"Stable White\",\n#   \"2\" = \"Stable Black\",\n#   \"3\" = \"White to Hispanic\",\n#   \"4\" = \"Gentrifying (Black to White)\",\n#   ... etc\n# )\n\ncensus_wide$trajectory_label <- trajectory_names[as.character(census_wide$sequence_cluster)]\n```\n\n---\n\n# STEP 6: Visualize Trajectory Clusters\n\n## Sequence Frequency Plots\n\n```{r sequence_frequency_plots, fig.height=10, fig.width=8}\n# Plot sequence frequency for each trajectory cluster\npar(mfrow = c(4, 4))  # Adjust layout based on num_clusters\n\nfor(i in 1:num_clusters) {\n  seqfplot(\n    sequence_data[census_wide$sequence_cluster == i, ],\n    sortv = \"from.start\",\n    border = NA,\n    main = paste(\"Cluster\", i, \"\\n\", \n                trajectory_names[as.character(i)],\n                \"\\n(n =\", sum(census_wide$sequence_cluster == i), \")\")\n  )\n}\n\npar(mfrow = c(1, 1))\n```\n\n## Map Trajectory Clusters\n\n```{r map_trajectories}\n# Join trajectory clusters to spatial data\ntract_trajectories <- tract %>%\n  left_join(census_wide %>% \n             select(TRTID10, sequence_cluster, trajectory_label),\n            by = \"TRTID10\")\n\n# Map all trajectories\nggplot(tract_trajectories) +\n  geom_sf(aes(fill = factor(sequence_cluster)), color = NA, size = 0.1) +\n  geom_sf(data = my_metro_counties, fill = NA, color = \"black\", size = 0.5) +\n  scale_fill_viridis_d(option = \"turbo\") +\n  labs(title = \"Neighborhood Trajectory Clusters (1980-2020)\",\n       fill = \"Trajectory\") +\n  theme_void() +\n  theme(legend.position = \"right\")\n\n# Map specific trajectory types of interest\n# Example: Map just the gentrification trajectories\n# gentrification_clusters <- c(10, 11)  # Adjust to YOUR clusters\n# \n# tract_gentrification <- tract_trajectories %>%\n#   mutate(is_gentrifying = sequence_cluster %in% gentrification_clusters)\n# \n# ggplot(tract_gentrification) +\n#   geom_sf(aes(fill = is_gentrifying), color = NA) +\n#   scale_fill_manual(values = c(\"gray90\", \"darkred\"),\n#                     labels = c(\"Other\", \"Gentrifying\")) +\n#   labs(title = \"Gentrification Trajectories\") +\n#   theme_void()\n```\n\n---\n\n# STEP 7: Analysis & Interpretation\n\n## Summary Statistics\n\n```{r summary_stats}\n# Most common trajectories\ntrajectory_counts <- census_wide %>%\n  group_by(trajectory_label) %>%\n  summarise(n_tracts = n()) %>%\n  arrange(desc(n_tracts)) %>%\n  mutate(pct = round(n_tracts / sum(n_tracts) * 100, 1))\n\nkable(trajectory_counts,\n      caption = \"Trajectory Cluster Frequencies\",\n      col.names = c(\"Trajectory\", \"# Tracts\", \"% of Total\"))\n\n# How many tracts remained stable?\nstability_cluster <- 2  # ADJUST if your stability cluster is different\nn_stable <- sum(census_wide$sequence_cluster == stability_cluster)\npct_stable <- round(n_stable / nrow(census_wide) * 100, 1)\n\ncat(\"\\nStability:\", n_stable, \"tracts (\", pct_stable, \"%) remained in same cluster 1980-2020\\n\")\n```\n\n## Key Findings\n\n**CUSTOMIZE:** Write YOUR city-specific findings\n\n```{r key_findings}\n# Template for findings:\ncat(\"\nKEY FINDINGS FOR [YOUR CITY]:\n\n1. DECLINE IN [GROUP] NEIGHBORHOODS\n   - In 1980: X% of tracts were majority [group]\n   - In 2020: Y% of tracts were majority [group]\n   \n2. GROWTH IN [GROUP] NEIGHBORHOODS\n   - Primary pathway: [Cluster X] - [describe transition]\n   - Secondary pathway: [Cluster Y] - [describe transition]\n   - Geographic concentration: [where]\n   \n3. GENTRIFICATION PATTERNS\n   - [Number] tracts showed gentrification trajectories\n   - Concentrated in: [neighborhoods/geography]\n   - Timing: Mostly occurred [1990-2000 / 2000-2010 / 2010-2020]\n   \n4. STABILITY\n   - [X]% of neighborhoods showed no change in dominant racial group\n   - Stable [group] neighborhoods located in: [where]\n   - Stable [group] neighborhoods located in: [where]\n   \n5. EMERGING PATTERNS\n   - [Any unique patterns you observe]\n   \n\")\n```\n\n\n# STEP 8: Export Results\n\n## Save Data\n\n```{r save_results}\n# Save final dataset with trajectory assignments\nwrite_csv(census_wide, \"output/trajectory_clusters.csv\")\n\n# Save spatial data\nst_write(tract_trajectories, \n         \"output/trajectory_map.shp\", \n         delete_dsn = TRUE)\n\ncat(\"Results saved to output/ folder\\n\")\n```\n\n## Create Summary Report\n\n```{r summary_report}\n# Summary for portfolio or presentation\nsummary_stats <- list(\n  metro_area = \"[YOUR CITY NAME]\",\n  n_tracts = nrow(census_wide),\n  years_analyzed = \"1980-2020\",\n  k_clusters = k_chosen,\n  n_trajectories = num_clusters,\n  pct_stable = pct_stable,\n  most_common_trajectory = trajectory_counts$trajectory_label[1]\n)\n\n```\n\n---\n\n# Reflection\n\n## What did you learn?\n\n1. **About the method:**\n   - What was most challenging?\n   - What surprised you about the OMstrans approach?\n   - How did choosing k affect your results?\n\n2. **About your city:**\n   - What patterns did you expect to see?\n   - What patterns surprised you?\n   - How do your results compare to NYC?\n\n3. **About policy applications:**\n   - How could this inform interventions?\n   - What are the ethical considerations?\n   - How might prediction interact with these trajectories?\n\nWrite your reflection here:\n\n```\n[YOUR REFLECTION]\n```\n\n---\n\n\n# References & Resources\n\n**Tutorial:**\n- https://ericdelmelle.github.io/sequencePaper/\n\n**Key Papers:**\n- Delmelle (2017): Differentiating pathways of neighborhood change\n- Delmelle (2016): Mapping the DNA of urban neighborhoods\n\n**R Packages:**\n- TraMineR: https://traminer.unige.ch/\n- tidycensus: https://walker-data.com/tidycensus/\n\n**Data:**\n- LTDB: https://s4.ad.brown.edu/projects/diversity/Researcher/Bridging.htm\n- Census API: https://api.census.gov/data/key_signup.html\n\n---\n\n*This analysis was completed for MUSA 5080: Public Policy Analytics at the University of Pennsylvania.*\n","srcMarkdownNoYaml":"\n\n# BEFORE YOU START: Customization Checklist\n\n**This template follows the NYC tutorial workflow. You MUST customize:**\n\n- [ ] Line 50-52: Replace NYC county names with YOUR metro counties\n- [ ] Line 54: Replace \"NY\" with YOUR state abbreviation\n- [ ] Line 102-107: Update county filter to YOUR metro counties\n- [ ] Line 270: Adjust k value (may not be 6 for your city)\n- [ ] Line 276-281: Relabel clusters based on YOUR city's demographics\n- [ ] Line 436: Adjust number of trajectory clusters (may not be 14)\n- [ ] Line 444-457: Rename trajectory clusters based on YOUR patterns\n\n**Data Requirements:**\n- LTDB data files in `data/` folder (1980, 1990, 2000, 2010)\n- 2020 Census data (will download via tidycensus)\n- Census API key (get from: https://api.census.gov/data/key_signup.html)\n\n---\n\n# Setup\n\n## Load Libraries\n\n```{r setup}\nlibrary(tidyverse)      # Data manipulation\nlibrary(tidycensus)     # Census data\nlibrary(sf)             # Spatial data\nlibrary(tigris)         # Census boundaries\nlibrary(TraMineR)       # Sequence analysis\nlibrary(cluster)        # Clustering\nlibrary(factoextra)     # Cluster visualization\nlibrary(WeightedCluster)# Cluster validation\nlibrary(knitr)          # Tables\nlibrary(here)           # File paths\n\n# Set Census API key - GET YOUR OWN KEY!\n# census_api_key(\"YOUR_KEY_HERE\", install = TRUE)\n```\n\n## Load LTDB Data\n\n**CUSTOMIZE:** Ensure your file paths match your data location\n\n```{r load_data}\n# Load longitudinal census data from LTDB\ncensus20 <- read.csv(\"data/ltdb_std_2020_fullcount.csv\")\ncensus10 <- read.csv(\"data/LTDB_Std_2010_fullcount.csv\")\ncensus00 <- read.csv(\"data/LTDB_Std_2000_fullcount.csv\")\ncensus90 <- read.csv(\"data/LTDB_Std_1990_fullcount.csv\")\ncensus80 <- read.csv(\"data/LTDB_Std_1980_fullcount.csv\")\n```\n\n## Get Tract Geometries\n\n**CUSTOMIZE:** Replace with YOUR metro area\n\n```{r get_geometry}\n# STEP 1: Define YOUR metro counties\n# NYC example:\nmy_counties <- c(\"Kings\", \"Queens\", \"New York\", \"Richmond\", \"Bronx\")\n# YOUR CITY - Example for Philadelphia:\n# my_counties <- c(\"Philadelphia\", \"Montgomery\", \"Delaware\", \"Chester\", \"Bucks\")\n\nmy_state <- \"NY\"  # CHANGE TO YOUR STATE (e.g., \"PA\", \"CA\", \"TX\")\n\n# Download tract geometries for 2010\ntract <- get_decennial(\n  geography = \"tract\",\n  variables = \"P001001\",\n  year = 2010,\n  state = my_state,\n  county = my_counties,\n  geometry = TRUE,\n  progress = FALSE\n)\n\n# Also get county boundaries for mapping\nmy_state_counties <- counties(state = my_state, cb = TRUE, progress = FALSE)\nmy_metro_counties <- my_state_counties %>%\n  filter(NAME %in% my_counties)\n```\n\n---\n\n# STEP 1: Data Preparation\n\n## Calculate Race/Ethnicity Percentages\n\n```{r calculate_percentages}\n# 1980 data\ncensus80 <- census80 %>% \n  filter(POP80 > 0) %>%\n  mutate(\n    perwhite80 = NHWHT80 / POP80,\n    perblack80 = NHBLK80 / POP80,\n    perhisp80 = HISP80 / POP80,\n    perasian80 = ASIAN80 / POP80\n  ) %>%\n  select(TRTID10, perwhite80, perblack80, perhisp80, perasian80)\n\n# 1990 data\ncensus90 <- census90 %>%\n  filter(POP90 > 0) %>%\n  mutate(\n    perwhite90 = NHWHT90 / POP90,\n    perblack90 = NHBLK90 / POP90,\n    perhisp90 = HISP90 / POP90,\n    perasian90 = ASIAN90 / POP90\n  ) %>%\n  select(TRTID10, state, county, perwhite90, perblack90, perhisp90, perasian90)\n\n# 2000 data\ncensus00 <- census00 %>%\n  filter(POP00 > 0) %>%\n  mutate(\n    perwhite00 = NHWHT00 / POP00,\n    perblack00 = NHBLK00 / POP00,\n    perhisp00 = HISP00 / POP00,\n    perasian00 = ASIAN00 / POP00\n  ) %>%\n  select(TRTID10, perwhite00, perblack00, perhisp00, perasian00)\n\n# 2010 data\ncensus10 <- census10 %>%\n  rename(TRTID10 = tractid) %>%\n  mutate(\n    perwhite10 = nhwht10 / pop10,\n    perblack10 = nhblk10 / pop10,\n    perhisp10 = hisp10 / pop10,\n    perasian10 = asian10 / pop10\n  ) %>%\n  select(TRTID10, perwhite10, perblack10, perhisp10, perasian10)\n\n# 2020 data\ncensus20 <- census20 %>%\n  rename(TRTID10 = TRTID2010) %>%\n  mutate(\n    perwhite20 = nhwt20 / pop20,\n    perblack20 = nhblk20 / pop20,\n    perhisp20 = hisp20 / pop20,\n    perasian20 = asian20 / pop20\n  ) %>%\n  select(TRTID10, perwhite20, perblack20, perhisp20, perasian20)\n```\n\n## Join All Years & Filter to Metro\n\n```{r join_and_filter}\n# Join all decades\ncensus_all <- census90 %>%\n  left_join(census00, by = \"TRTID10\") %>%\n  left_join(census10, by = \"TRTID10\") %>%\n  left_join(census20, by = \"TRTID10\") %>%\n  left_join(census80, by = \"TRTID10\")\n\n# CUSTOMIZE: Filter to YOUR metro counties\n# NYC example:\ncensus_metro <- census_all %>%\n  filter(\n    (state == \"NY\" & county == \"Bronx County\") |\n    (state == \"NY\" & county == \"Kings County\") |\n    (state == \"NY\" & county == \"New York County\") |\n    (state == \"NY\" & county == \"Queens County\") |\n    (state == \"NY\" & county == \"Richmond County\")\n  )\n\n# YOUR CITY - Example for Philadelphia:\n# census_metro <- census_all %>%\n#   filter(\n#     (state == \"PA\" & county == \"Philadelphia County\") |\n#     (state == \"PA\" & county == \"Montgomery County\") |\n#     (state == \"PA\" & county == \"Delaware County\") |\n#     (state == \"PA\" & county == \"Chester County\") |\n#     (state == \"PA\" & county == \"Bucks County\")\n#   )\n\n# Remove NAs and unnecessary columns\ncensus_metro <- census_metro %>%\n  na.omit() %>%\n  select(-state, -county)\n\n# Prepare tract geometries\ntract <- tract %>%\n  select(GEOID, geometry) %>%\n  rename(TRTID10 = GEOID) %>%\n  mutate(TRTID10 = as.double(TRTID10))\n\n# Check results\ncat(\"Number of tracts in analysis:\", nrow(census_metro), \"\\n\")\n```\n\n---\n\n# STEP 2: K-Means Clustering\n\n## Convert to Long Format\n\n```{r reshape_long}\n# Pivot to long format: one row per tract-year\ncensus_long <- census_metro %>%\n  pivot_longer(\n    cols = starts_with(\"per\"),\n    names_to = c(\".value\", \"year\"),\n    names_pattern = \"per(\\\\w+)(\\\\d{2})\"\n  ) %>%\n  mutate(year = case_when(\n    year == \"80\" ~ 1980,\n    year == \"90\" ~ 1990,\n    year == \"00\" ~ 2000,\n    year == \"10\" ~ 2010,\n    year == \"20\" ~ 2020,\n    TRUE ~ as.integer(year)\n  ))\n\n# Data for clustering\ndata_for_clustering <- census_long %>%\n  select(white, black, hisp, asian)\n```\n\n## Test Multiple K Values\n\n```{r test_k_values}\n# Function to calculate WSS\nwss <- function(k) {\n  kmeans(data_for_clustering, k, nstart = 10)$tot.withinss\n}\n\n# Test k from 1 to 10\nk_values <- 1:10\nwss_values <- map_dbl(k_values, wss)\n\n# Elbow plot\nplot(k_values, wss_values, type = \"b\", pch = 19, \n     xlab = \"Number of Clusters K\",\n     ylab = \"Total Within-Cluster Sum of Squares\",\n     main = \"Elbow Method for Optimal K\")\n\n# Silhouette plot\nfviz_nbclust(data_for_clustering, kmeans, method = \"silhouette\") +\n  labs(title = \"Silhouette Method for Optimal K\")\n```\n\n## Choose K and Run K-Means\n\n**CUSTOMIZE:** Adjust k based on your elbow plot AND what makes sense for your city\n\n```{r run_kmeans}\n# NYC used k=6. Your city may need different k!\n# Consider:\n# - What does the elbow plot suggest?\n# - How diverse is your metro area?\n# - Do you need to distinguish mixed-race neighborhoods?\n\nk_chosen <- 6  # ADJUST THIS IF NEEDED\n\nset.seed(123)\nkmeans_result <- kmeans(data_for_clustering, \n                        centers = k_chosen, \n                        nstart = 25)\n\n# Add cluster assignments\ncensus_long$cluster <- kmeans_result$cluster\n\n# Examine cluster centroids\ncluster_profiles <- census_long %>%\n  group_by(cluster) %>%\n  summarise(across(c(white, black, hisp, asian), \n                  ~ round(mean(.), 2)))\n\nkable(cluster_profiles, \n      caption = \"Cluster Profiles: Average Demographics\")\n```\n\n## Label Your Clusters\n\n**CUSTOMIZE:** Give meaningful names based on YOUR city's demographics\n\n```{r label_clusters}\n# NYC example labels (based on demographic profiles):\ncluster_labels <- c(\n  \"1\" = \"1 Black\",\n  \"2\" = \"2 Hispanic\", \n  \"3\" = \"3 White\",\n  \"4\" = \"4 Mixed\",\n  \"5\" = \"5 Asian\",\n  \"6\" = \"6 Black & Hispanic\"\n)\n\n# YOUR CITY: Look at cluster_profiles table above and create YOUR labels\n# Example for different composition:\n# cluster_labels <- c(\n#   \"1\" = \"Majority White\",\n#   \"2\" = \"Majority Black\",\n#   \"3\" = \"Hispanic Growth\",\n#   \"4\" = \"Mixed Race\",\n#   \"5\" = \"Asian Emerging\",\n#   \"6\" = \"Black-Hispanic\"\n# )\n\ncensus_long$label <- factor(cluster_labels[as.character(census_long$cluster)])\n```\n\n## Visualize Clusters\n\n```{r visualize_clusters}\n# Stacked bar chart of cluster makeup\ncluster_profiles_long <- cluster_profiles %>%\n  pivot_longer(cols = c(\"white\", \"black\", \"hisp\", \"asian\"),\n               names_to = \"Demographic\", \n               values_to = \"Proportion\")\n\nggplot(cluster_profiles_long, \n       aes(x = factor(cluster), y = Proportion, fill = Demographic)) +\n  geom_bar(stat = \"identity\") +\n  labs(title = paste(\"Cluster Demographic Makeup - k =\", k_chosen),\n       x = \"Cluster\", y = \"Proportion\") +\n  theme_minimal()\n\n# Map clusters for 2020\ntract_with_clusters <- tract %>%\n  left_join(census_long %>% \n             filter(year == 2020) %>%\n             select(TRTID10, label),\n            by = \"TRTID10\")\n\nggplot(tract_with_clusters) +\n  geom_sf(aes(fill = label), color = NA) +\n  geom_sf(data = my_metro_counties, fill = NA, color = \"black\", size = 0.5) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(title = \"Neighborhood Racial/Ethnic Clusters - 2020\",\n       fill = \"Cluster\") +\n  theme_void()\n```\n\n## Small Multiples: Change Over Time\n\n```{r small_multiples}\ndecades <- c(1980, 1990, 2000, 2010, 2020)\n\ntract_all_decades <- tract %>%\n  left_join(census_long %>% select(TRTID10, year, label),\n            by = \"TRTID10\") %>%\n  filter(!is.na(label)) %>%\n  mutate(year = factor(year, levels = decades))\n\nggplot(tract_all_decades) +\n  geom_sf(aes(fill = label), color = NA) +\n  geom_sf(data = my_metro_counties, fill = NA, \n          color = \"black\", size = 0.5) +\n  facet_wrap(~ year, ncol = 5) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(title = \"Racial Cluster Maps by Decade (1980-2020)\",\n       fill = \"Cluster\") +\n  theme_void() +\n  theme(legend.position = \"bottom\")\n```\n\n**Question:** What spatial patterns do you observe? Where is change occurring?\n\n---\n\n# STEP 3: Sequence Analysis\n\n## Create Sequence Object\n\n```{r create_sequences}\n# Convert to wide format: one row per tract\ncensus_wide <- census_long %>%\n  select(TRTID10, year, label) %>%\n  pivot_wider(names_from = year, values_from = label) %>%\n  select(TRTID10, `1980`, `1990`, `2000`, `2010`, `2020`)\n\n# Check unique states\nunique_states <- unique(unlist(census_wide[, -1]))\nprint(unique_states)\n\n# Create sequence object\nsequence_data <- seqdef(census_wide[, -1])  # Exclude TRTID10\n\n# Check number of distinct sequences\nnum_sequences <- seqtab(sequence_data, idx = 0) %>% nrow\ncat(\"Number of unique sequences:\", num_sequences, \"\\n\")\n\n# Display first few sequences\nhead(sequence_data)\n```\n\n## Visualize All Sequences\n\n```{r plot_sequences}\n# Index plot: shows all sequences\nseqIplot(sequence_data,\n         with.legend = \"right\",\n         cex.legend = 0.6,\n         main = \"All Neighborhood Trajectories (1980-2020)\")\n\n# State distribution plot\nseqdplot(sequence_data, \n         border = NA,\n         main = \"Distribution of Cluster States Over Time\")\n\n# Most frequent sequences\nseqfplot(sequence_data,\n         border = NA,\n         main = \"Most Frequent Sequences\")\n```\n\n**Discuss:** \n- What's the most common pattern (stability? change?)\n- When do most transitions occur?\n\n---\n\n# STEP 4: Compute Dissimilarity (OMstrans)\n\n```{r compute_dissimilarity}\n# Compute substitution costs based on transition rates\ncosts <- seqcost(sequence_data, method = \"TRATE\")\n\n# View substitution cost matrix\ncat(\"Substitution Cost Matrix (based on transition frequencies):\\n\")\nround(costs$sm, 2) %>% \n  as.data.frame() %>%\n  kable()\n\n# Compute OMstrans dissimilarity\n# Parameters:\n# - method = \"OMstran\" (emphasizes ORDER of transitions)\n# - otto = 0.1 (low value = more emphasis on sequencing)\n# - indel = 3 (cost of insertion/deletion)\n# - sm = costs$sm (substitution costs from above)\n\nom_distances <- seqdist(sequence_data, \n                        method = \"OMstran\",\n                        indel = 3,\n                        sm = costs$sm,\n                        otto = 0.1)\n\ncat(\"Dissimilarity matrix computed!\\n\")\ncat(\"Dimensions:\", dim(om_distances), \"\\n\")\n```\n\n**Note:** This may take several minutes for large metros (2000+ tracts)\n\n---\n\n# STEP 5: Hierarchical Clustering of Sequences\n\n## Perform Clustering\n\n```{r hierarchical_clustering}\n# Hierarchical clustering using Ward's method\nclusterward <- agnes(om_distances, diss = TRUE, method = \"ward\")\n\n# Test different numbers of trajectory clusters\n# Start high (e.g., k=20) and examine\ntest_k <- 20\n\nfor(k in c(10, 15, 20)) {\n  clusters <- cutree(clusterward, k = k)\n  cat(\"\\nTesting k =\", k, \"\\n\")\n  cat(\"Cluster sizes:\", table(clusters), \"\\n\")\n}\n```\n\n## Examine Trajectory Clusters Iteratively\n\n```{r examine_trajectories}\n# Start with k=20 and look at sequence frequency plots\ntest_k <- 20\ntest_clusters <- cutree(clusterward, k = test_k)\n\n# Function to plot a specific cluster\nplot_cluster <- function(cluster_num) {\n  seqfplot(sequence_data[test_clusters == cluster_num, ],\n           sortv = \"from.start\",\n           border = NA,\n           main = paste(\"Test Cluster\", cluster_num,\n                       \"(n =\", sum(test_clusters == cluster_num), \")\"))\n}\n\n# Examine clusters 1-5 (do more as needed)\npar(mfrow = c(2, 3))\nfor(i in 1:6) {\n  plot_cluster(i)\n}\npar(mfrow = c(1, 1))\n```\n\n**Instructions:**\n1. Look at each cluster's sequence plot\n2. Note which clusters show similar patterns\n3. Merge clusters that are essentially the same trajectory\n4. Stop when you'd have to merge opposite trajectories\n\n## Choose Final K\n\n**CUSTOMIZE:** Adjust based on your iterative examination\n\n```{r final_clustering}\n# NYC settled on k=14. Your city may need more or fewer!\n# Guidelines:\n# - Smaller metros may have 8-12 trajectory types\n# - Larger, more diverse metros may have 15-20\n# - Balance interpretability with granularity\n\nnum_clusters <- 14  # ADJUST THIS BASED ON YOUR EXAMINATION\n\n# Final clustering\nfinal_clusters <- cutree(clusterward, k = num_clusters)\ncensus_wide$sequence_cluster <- final_clusters\n\n# Cluster sizes\ncat(\"Final cluster sizes:\\n\")\ntable(final_clusters)\n\n# Validate with silhouette widths\nsil <- silhouette(final_clusters, om_distances)\ncat(\"\\nAverage silhouette width:\", round(mean(sil[, \"sil_width\"]), 3), \"\\n\")\ncat(\"(Values > 0.25 indicate reasonable clustering)\\n\")\n```\n\n## Name Your Trajectory Clusters\n\n**CUSTOMIZE:** Give meaningful names after examining sequence plots\n\n```{r name_trajectories}\n# NYC example (k=14):\ntrajectory_names <- c(\n  \"1\" = \"Hispanic Majority to Black & Hispanic\",\n  \"2\" = \"Stability Cluster\",\n  \"3\" = \"White & Mixed Race to Hispanic Majority\",\n  \"4\" = \"White to White & Mixed Race to Hispanic Majority\",\n  \"5\" = \"Black & Hispanic to Hispanic Majority\",\n  \"6\" = \"White Majority to White & Mixed Race\",\n  \"7\" = \"White & Mixed Race to Black & Hispanic\",\n  \"8\" = \"Black & Hispanic to Black Majority\",\n  \"9\" = \"White & Mixed Race to Asian Majority\",\n  \"10\" = \"White & Mixed Race to White Majority\",\n  \"11\" = \"Black & Hispanic to White & Mixed Race\",\n  \"12\" = \"White & Mixed Race to Asian Majority\",\n  \"13\" = \"Black Majority to Black & Hispanic\",\n  \"14\" = \"Black & Hispanic to Asian Majority\"\n)\n\n# YOUR CITY: Create YOUR trajectory names based on sequence plots\n# Example:\n# trajectory_names <- c(\n#   \"1\" = \"Stable White\",\n#   \"2\" = \"Stable Black\",\n#   \"3\" = \"White to Hispanic\",\n#   \"4\" = \"Gentrifying (Black to White)\",\n#   ... etc\n# )\n\ncensus_wide$trajectory_label <- trajectory_names[as.character(census_wide$sequence_cluster)]\n```\n\n---\n\n# STEP 6: Visualize Trajectory Clusters\n\n## Sequence Frequency Plots\n\n```{r sequence_frequency_plots, fig.height=10, fig.width=8}\n# Plot sequence frequency for each trajectory cluster\npar(mfrow = c(4, 4))  # Adjust layout based on num_clusters\n\nfor(i in 1:num_clusters) {\n  seqfplot(\n    sequence_data[census_wide$sequence_cluster == i, ],\n    sortv = \"from.start\",\n    border = NA,\n    main = paste(\"Cluster\", i, \"\\n\", \n                trajectory_names[as.character(i)],\n                \"\\n(n =\", sum(census_wide$sequence_cluster == i), \")\")\n  )\n}\n\npar(mfrow = c(1, 1))\n```\n\n## Map Trajectory Clusters\n\n```{r map_trajectories}\n# Join trajectory clusters to spatial data\ntract_trajectories <- tract %>%\n  left_join(census_wide %>% \n             select(TRTID10, sequence_cluster, trajectory_label),\n            by = \"TRTID10\")\n\n# Map all trajectories\nggplot(tract_trajectories) +\n  geom_sf(aes(fill = factor(sequence_cluster)), color = NA, size = 0.1) +\n  geom_sf(data = my_metro_counties, fill = NA, color = \"black\", size = 0.5) +\n  scale_fill_viridis_d(option = \"turbo\") +\n  labs(title = \"Neighborhood Trajectory Clusters (1980-2020)\",\n       fill = \"Trajectory\") +\n  theme_void() +\n  theme(legend.position = \"right\")\n\n# Map specific trajectory types of interest\n# Example: Map just the gentrification trajectories\n# gentrification_clusters <- c(10, 11)  # Adjust to YOUR clusters\n# \n# tract_gentrification <- tract_trajectories %>%\n#   mutate(is_gentrifying = sequence_cluster %in% gentrification_clusters)\n# \n# ggplot(tract_gentrification) +\n#   geom_sf(aes(fill = is_gentrifying), color = NA) +\n#   scale_fill_manual(values = c(\"gray90\", \"darkred\"),\n#                     labels = c(\"Other\", \"Gentrifying\")) +\n#   labs(title = \"Gentrification Trajectories\") +\n#   theme_void()\n```\n\n---\n\n# STEP 7: Analysis & Interpretation\n\n## Summary Statistics\n\n```{r summary_stats}\n# Most common trajectories\ntrajectory_counts <- census_wide %>%\n  group_by(trajectory_label) %>%\n  summarise(n_tracts = n()) %>%\n  arrange(desc(n_tracts)) %>%\n  mutate(pct = round(n_tracts / sum(n_tracts) * 100, 1))\n\nkable(trajectory_counts,\n      caption = \"Trajectory Cluster Frequencies\",\n      col.names = c(\"Trajectory\", \"# Tracts\", \"% of Total\"))\n\n# How many tracts remained stable?\nstability_cluster <- 2  # ADJUST if your stability cluster is different\nn_stable <- sum(census_wide$sequence_cluster == stability_cluster)\npct_stable <- round(n_stable / nrow(census_wide) * 100, 1)\n\ncat(\"\\nStability:\", n_stable, \"tracts (\", pct_stable, \"%) remained in same cluster 1980-2020\\n\")\n```\n\n## Key Findings\n\n**CUSTOMIZE:** Write YOUR city-specific findings\n\n```{r key_findings}\n# Template for findings:\ncat(\"\nKEY FINDINGS FOR [YOUR CITY]:\n\n1. DECLINE IN [GROUP] NEIGHBORHOODS\n   - In 1980: X% of tracts were majority [group]\n   - In 2020: Y% of tracts were majority [group]\n   \n2. GROWTH IN [GROUP] NEIGHBORHOODS\n   - Primary pathway: [Cluster X] - [describe transition]\n   - Secondary pathway: [Cluster Y] - [describe transition]\n   - Geographic concentration: [where]\n   \n3. GENTRIFICATION PATTERNS\n   - [Number] tracts showed gentrification trajectories\n   - Concentrated in: [neighborhoods/geography]\n   - Timing: Mostly occurred [1990-2000 / 2000-2010 / 2010-2020]\n   \n4. STABILITY\n   - [X]% of neighborhoods showed no change in dominant racial group\n   - Stable [group] neighborhoods located in: [where]\n   - Stable [group] neighborhoods located in: [where]\n   \n5. EMERGING PATTERNS\n   - [Any unique patterns you observe]\n   \n\")\n```\n\n\n# STEP 8: Export Results\n\n## Save Data\n\n```{r save_results}\n# Save final dataset with trajectory assignments\nwrite_csv(census_wide, \"output/trajectory_clusters.csv\")\n\n# Save spatial data\nst_write(tract_trajectories, \n         \"output/trajectory_map.shp\", \n         delete_dsn = TRUE)\n\ncat(\"Results saved to output/ folder\\n\")\n```\n\n## Create Summary Report\n\n```{r summary_report}\n# Summary for portfolio or presentation\nsummary_stats <- list(\n  metro_area = \"[YOUR CITY NAME]\",\n  n_tracts = nrow(census_wide),\n  years_analyzed = \"1980-2020\",\n  k_clusters = k_chosen,\n  n_trajectories = num_clusters,\n  pct_stable = pct_stable,\n  most_common_trajectory = trajectory_counts$trajectory_label[1]\n)\n\n```\n\n---\n\n# Reflection\n\n## What did you learn?\n\n1. **About the method:**\n   - What was most challenging?\n   - What surprised you about the OMstrans approach?\n   - How did choosing k affect your results?\n\n2. **About your city:**\n   - What patterns did you expect to see?\n   - What patterns surprised you?\n   - How do your results compare to NYC?\n\n3. **About policy applications:**\n   - How could this inform interventions?\n   - What are the ethical considerations?\n   - How might prediction interact with these trajectories?\n\nWrite your reflection here:\n\n```\n[YOUR REFLECTION]\n```\n\n---\n\n\n# References & Resources\n\n**Tutorial:**\n- https://ericdelmelle.github.io/sequencePaper/\n\n**Key Papers:**\n- Delmelle (2017): Differentiating pathways of neighborhood change\n- Delmelle (2016): Mapping the DNA of urban neighborhoods\n\n**R Packages:**\n- TraMineR: https://traminer.unige.ch/\n- tidycensus: https://walker-data.com/tidycensus/\n\n**Data:**\n- LTDB: https://s4.ad.brown.edu/projects/diversity/Researcher/Bridging.htm\n- Census API: https://api.census.gov/data/key_signup.html\n\n---\n\n*This analysis was completed for MUSA 5080: Public Policy Analytics at the University of Pennsylvania.*\n"},"formats":{"html":{"identifier":{"display-name":"HTML","target-format":"html","base-format":"html"},"execute":{"fig-width":7,"fig-height":5,"fig-format":"retina","fig-dpi":96,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":"auto","echo":true,"output":true,"warning":false,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"message":false,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"html","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"show","code-overflow":"scroll","code-link":false,"code-line-numbers":false,"code-tools":false,"tbl-colwidths":"auto","merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"notebook-links":true},"pandoc":{"standalone":true,"wrap":"none","default-image-extension":"png","to":"html","toc":true,"self-contained":true,"output-file":"sequence_analysis_TEMPLATE.html"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","appendix-view-license":"View License","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words","listing-page-filter":"Filter","draft":"Draft"},"metadata":{"lang":"en","fig-responsive":true,"quarto-version":"1.8.24","theme":"cosmo","title":"Sequence Analysis of Neighborhood Change: [YOUR CITY NAME]","subtitle":"MUSA 5080 - Week 8 Lab Exercise","author":"Your Name","date":"today"},"extensions":{"book":{"multiFile":true}}}},"projectFormats":["html"]}