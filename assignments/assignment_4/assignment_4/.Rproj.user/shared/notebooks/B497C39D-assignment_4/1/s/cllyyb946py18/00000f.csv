"0","# Fit final model on all data"
"0","final_model <- glm.nb("
"0","  countBurglaries ~ street_lights + street_lights.nn + "
"0","    dist_to_hotspot,"
"0","  data = fishnet_model"
"0",")"
"0",""
"0","# Add predictions back to fishnet"
"0","fishnet <- fishnet %>%"
"0","  mutate("
"0","    prediction_nb = predict(final_model, fishnet_model, type = ""response"")[match(uniqueID, fishnet_model$uniqueID)]"
"0","  )"
"0",""
"0","# Also add KDE predictions (normalize to same scale as counts)"
"0","kde_sum <- sum(fishnet$kde_value, na.rm = TRUE)"
"0","count_sum <- sum(fishnet$countBurglaries, na.rm = TRUE)"
"0","fishnet <- fishnet %>%"
"0","  mutate("
"0","    prediction_kde = (kde_value / kde_sum) * count_sum"
"0","  )"
