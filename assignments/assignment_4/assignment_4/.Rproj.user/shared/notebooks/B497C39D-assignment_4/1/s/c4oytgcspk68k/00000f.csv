"0","#| message: false"
"0",""
"0","# Convert burglaries to ppp (point pattern) format for spatstat"
"0","burglaries_ppp <- as.ppp("
"0","  st_coordinates(burglaries),"
"0","  W = as.owin(st_bbox(chicagoBoundary))"
"0",")"
"2","Warning:"
"2"," 4 points were rejected as lying outside the specified window
"
"2","Warning:"
"2"," data contain duplicated points
"
"0","# Calculate KDE with 1km bandwidth"
"0","kde_burglaries <- density.ppp("
"0","  burglaries_ppp,"
"0","  sigma = 1000,  # 1km bandwidth"
"0","  edge = TRUE    # Edge correction"
"0",")"
"0",""
"0","# Convert to terra raster (modern approach, not raster::raster)"
"0","kde_raster <- rast(kde_burglaries)"
"0",""
"0","# Extract KDE values to fishnet cells"
"0","fishnet <- fishnet %>%"
"0","  mutate("
"0","    kde_value = terra::extract("
"0","      kde_raster,"
"0","      vect(fishnet),"
"0","      fun = mean,"
"0","      na.rm = TRUE"
"0","    )[, 2]  # Extract just the values column"
"0","  )"
"0",""
"0","cat(""✓ Calculated KDE baseline\n"")"
"1","✓ Calculated KDE baseline
"
